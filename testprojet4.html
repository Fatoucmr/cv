<!DOCTYPE html>
<html lang="fr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Attrape les Ã‰toiles : Les 3 Niveaux + Niveau SpÃ©cial â­</title>
Â  Â Â 
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.min.js"></script>

Â  Â  <style>
Â  Â  Â  Â  /* ğŸ¨ CSS du Jeu */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  background-color: #000000;Â 
Â  Â  Â  Â  Â  Â  color: #ffffff;Â 
Â  Â  Â  Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #control-panel {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  justify-content: flex-start;Â 
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.9);Â 
Â  Â  Â  Â  Â  Â  z-index: 200;
Â  Â  Â  Â  Â  Â  transition: opacity 0.5s;
Â  Â  Â  Â  Â  Â  padding: 40px;Â 
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  overflow-y: auto;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â Â 
Â  Â  Â  Â  #control-panel.hidden {
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  #control-panel h1 {
Â  Â  Â  Â  Â  Â  color: #ffffff;Â 
Â  Â  Â  Â  Â  Â  margin-top: 0;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #game-screen {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  width: 800px;Â 
Â  Â  Â  Â  Â  Â  height: 600px;Â 
Â  Â  Â  Â  Â  Â  border: 5px solid #4fafff;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 50px rgba(79, 175, 255, 0.5);
Â  Â  Â  Â  Â  Â  background-color: #000a1a;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â Â 
Â  Â  Â  Â  #score-board, #countdownExample, #level-display {
Â  Â  Â  Â  Â  Â  color: #ffffff;Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(11, 12, 16, 0.7);Â 
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  z-index: 100;
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  #score-board {Â 
Â  Â  Â  Â  Â  Â  left: 50%;Â 
Â  Â  Â  Â  Â  Â  transform: translateX(-50%);Â 
Â  Â  Â  Â  Â  Â  font-size: 2em;Â 
Â  Â  Â  Â  Â  Â  border: 2px solid #FFFFFF;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  #countdownExample {Â 
Â  Â  Â  Â  Â  Â  right: 20px;Â 
Â  Â  Â  Â  Â  Â  font-size: 1.5em;Â 
Â  Â  Â  Â  Â  Â  border: 2px solid #FFFFFF;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  #level-display {Â 
Â  Â  Â  Â  Â  Â  left: 20px;Â 
Â  Â  Â  Â  Â  Â  font-size: 1.5em;Â 
Â  Â  Â  Â  Â  Â  border: 2px solid #FFFFFF;Â 
Â  Â  Â  Â  }


Â  Â  Â  Â  .game-button {
Â  Â  Â  Â  Â  Â  padding: 15px 30px;
Â  Â  Â  Â  Â  Â  margin: 10px;
Â  Â  Â  Â  Â  Â  font-size: 1.5em;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s, transform 0.1s;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 

Â  Â  Â  Â Â 
Â  Â  Â  Â  #level-selection-buttons {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .level-button {
Â  Â  Â  Â  Â  Â  padding: 15px 30px;
Â  Â  Â  Â  Â  Â  font-size: 1.5em;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s, transform 0.1s;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  color: black;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }


Â  Â  Â  Â  #select-level-1 { background-color: #A4BD01; }Â 
Â  Â  Â  Â  #select-level-2 { background-color: #FFE361; }Â 
Â  Â  Â  Â  #select-level-3 { background-color: #FC4E00; }Â 
Â  Â  Â  Â  #select-level-4 { background-color: #F44336; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #start-button, #next-level-button {
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .star {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  width: 30px;
Â  Â  Â  Â  Â  Â  height: 30px;
Â  Â  Â  Â  Â  Â  clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
Â  Â  Â  Â  Â  Â  animation: pulse 1s infinite alternate;
Â  Â  Â  Â  }

Â  Â  Â  Â  .star.level-1 { background-color: #ff4fa8; }
Â  Â  Â  Â  .star.level-2 { background-color: #4fafff; }
Â  Â  Â  Â  .star.level-3 { background-color: #ffffff; }
Â  Â  Â  Â  .star.level-4 { background-color: #F44336; }Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  #special-level-tip {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 70px;
Â  Â  Â  Â  Â  Â  right: 20px;
Â  Â  Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.9);
Â  Â  Â  Â  Â  Â  color: #000000;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  width: 200px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  border: 2px solid #F44336;
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  Â  Â  z-index: 101;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â Â 

Â  Â  Â  Â  .table-container {
Â  Â  Â  Â  Â  Â  margin: 30px 0;
Â  Â  Â  Â  Â  Â  width: 80%;
Â  Â  Â  Â  Â  Â  max-width: 450px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .table-container.active {
Â  Â  Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #message {
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  #score-table-container.active {
Â  Â  Â  Â  Â  Â  margin-bottom: 50px;Â 
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  }

Â  Â  Â  Â  .game-table {
Â  Â  Â  Â  Â  Â  margin: 10px auto;
Â  Â  Â  Â  Â  Â  border-collapse: collapse;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .game-table th, .game-table td {
Â  Â  Â  Â  Â  Â  border: 1px solid #4fafff;Â 
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  color: #ffffff;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .game-table th {
Â  Â  Â  Â  Â  Â  background-color: rgba(79, 175, 255, 0.2);Â 
Â  Â  Â  Â  Â  Â  color: #ffffff;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .level-score {
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: #4fafff;
Â  Â  Â  Â  }
Â  Â  Â  Â  .goal-met {
Â  Â  Â  Â  Â  Â  color: #90ee90;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  Â  Â  .goal-missed {
Â  Â  Â  Â  Â  Â  color: #ff6347;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <div id="game-screen">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="game-container">
Â  Â  Â  Â  Â  Â  <div id="score-board">Score: <span id="score">0</span></div>
Â  Â  Â  Â  Â  Â  <div id="level-display">Niveau: <span id="current-level">1</span></div>Â 

Â  Â  Â  Â  Â  Â  <div id="countdownExample">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="values"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="control-panel">
Â  Â  Â  Â  Â  Â  <h1>Attrape les Ã‰toiles â­</h1>
Â  Â  Â  Â  Â  Â  <p id="message">SÃ©lectionnez un niveau pour commencer.</p>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="score-table-container" class="table-container"></div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="level-selection-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="select-level-1" class="level-button" data-level="1">Niveau 1</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="select-level-2" class="level-button" data-level="2">Niveau 2</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="select-level-3" class="level-button" data-level="3">Niveau 3</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="select-level-4" class="level-button" data-level="4">Niveau SPÃ‰CIAL</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button id="start-button" class="game-button" style="display: none;"></button>
Â  Â  Â  Â  Â  Â  <button id="next-level-button" class="game-button" style="display: none;"></button>Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="special-level-tip">
Â  Â  Â  Â  CONSIGNE : Cliquez sur l'Ã©toile UNIQUEMENT si sa couleur est IDENTIQUE Ã  la couleur de la bordure du score ci-dessus. La couleur change !
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {

Â  Â  Â  Â  Â  Â  const synth = new Tone.Synth().toDestination();

Â  Â  Â  Â  Â  Â  const gameScreen = document.getElementById('game-screen');
Â  Â  Â  Â  Â  Â  const gameContainer = document.getElementById('game-container');
Â  Â  Â  Â  Â  Â  const scoreBoard = document.getElementById('score-board');
Â  Â  Â  Â  Â  Â  const scoreElement = document.getElementById('score');
Â  Â  Â  Â  Â  Â  const countdownDisplay = document.querySelector('#countdownExample .values');
Â  Â  Â  Â  Â  Â  const controlPanel = document.getElementById('control-panel');
Â  Â  Â  Â  Â  Â  const messageElement = document.getElementById('message');
Â  Â  Â  Â  Â  Â  const scoreTableContainer = document.getElementById('score-table-container');
Â  Â  Â  Â  Â  Â  const currentLevelDisplay = document.getElementById('current-level');
Â  Â  Â  Â  Â  Â  // const restartButton = document.getElementById('restart-button'); // RetirÃ©
Â  Â  Â  Â  Â  Â  const levelSelectionButtons = document.getElementById('level-selection-buttons');
Â  Â  Â  Â  Â  Â  const specialLevelTip = document.getElementById('special-level-tip');

Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const LEVELS = [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 1, time: 60, goal: 20, name: "Niveau 1: Facile", isSpecial: false },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 2, time: 40, goal: 40, name: "Niveau 2: Normal", isSpecial: false },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 3, time: 20, goal: 60, name: "Niveau 3: Difficile", isSpecial: false },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 4, time: 60, goal: 0, name: "Niveau SPÃ‰CIAL", isSpecial: true }
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Couleurs pour le Niveau SpÃ©cial (correspondent aux classes .star)
Â  Â  Â  Â  Â  Â  const SPECIAL_LEVEL_COLORS = [
Â  Â  Â  Â  Â  Â  Â  Â  '#ff4fa8',Â 
Â  Â  Â  Â  Â  Â  Â  Â  '#4fafff',Â 
Â  Â  Â  Â  Â  Â  Â  Â  '#ffffff',Â 
Â  Â  Â  Â  Â  Â  Â  Â  '#F44336', Â 
Â  Â  Â  Â  Â  Â  Â  Â  '#5D0D6E',
Â  Â  Â  Â  Â  Â  Â  Â  '#F8DE65',
Â  Â  Â  Â  Â  Â  Â  Â  '#0FAC71',
Â  Â  Â  Â  Â  Â  Â  Â  '#FC4E00'
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  let currentBorderColor = '#FFFFFF';
Â  Â  Â  Â  Â  Â  let colorChangeInterval;

Â  Â  Â  Â  Â  Â  // ParamÃ¨tres de jeu
Â  Â  Â  Â  Â  Â  let currentLevel = 1;
Â  Â  Â  Â  Â  Â  let score = 0;
Â  Â  Â  Â  Â  Â  let gameActive = false;
Â  Â  Â  Â  Â  Â  let timeLeft;
Â  Â  Â  Â  Â  Â  let timerInterval;
Â  Â  Â  Â  Â  Â  let starSpawnInterval;
Â  Â  Â  Â  Â  Â  let levelScores = {};

Â  Â  Â  Â  Â  Â  const STAR_SIZE = 30;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const STAR_LIFETIME_MS = 5000;Â 
Â  Â  Â  Â  Â  Â  const STAR_SPAWN_INTERVAL_MS = [1500, 1000, 700, 1500]; // Ajout du Niveau 4

Â  Â  Â  Â  Â  Â  // --- Fonctions de Score et Niveaux ---

Â  Â  Â  Â  Â  Â  function loadAllScores() {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const scoresString = localStorage.getItem('levelScores');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Initialisation ou chargement des scores
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let scores = scoresString ? JSON.parse(scoresString) : {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Assurez-vous que tous les niveaux existent avec un score minimum de 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  LEVELS.forEach(level => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (scores[level.id] === undefined) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scores[level.id] = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return scores;
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // En cas d'erreur de lecture, initialise tout Ã  0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return LEVELS.reduce((acc, level) => ({ ...acc, [level.id]: 0 }), {});
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function saveLevelScore() {
Â  Â  Â  Â  Â  Â  Â  Â  const allScores = loadAllScores();
Â  Â  Â  Â  Â  Â  Â  Â  // Enregistre le meilleur score (le score actuel s'il est supÃ©rieur au score sauvegardÃ©)
Â  Â  Â  Â  Â  Â  Â  Â  allScores[currentLevel] = Math.max(allScores[currentLevel] || 0, score);
Â  Â  Â  Â  Â  Â  Â  Â  levelScores = allScores;
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('levelScores', JSON.stringify(levelScores));
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erreur de sauvegarde du localStorage:", e);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  function displayLevelScores(showTotal = false) {
Â  Â  Â  Â  Â  Â  Â  Â  const scores = loadAllScores();
Â  Â  Â  Â  Â  Â  Â  Â  scoreTableContainer.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  let tableHTML = '<h2>ğŸ† Meilleurs Scores</h2>';
Â  Â  Â  Â  Â  Â  Â  Â  let totalScore = 0;

Â  Â  Â  Â  Â  Â  Â  Â  tableHTML += '<table class="game-table"><thead><tr><th>Niveau</th><th>Meilleur Score</th><th>Objectif</th></tr></thead><tbody>';

Â  Â  Â  Â  Â  Â  Â  Â  LEVELS.forEach((level) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const levelScore = scores[level.id] !== undefined ? scores[level.id] : 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalScore += levelScore;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let statusClass = '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // On n'affiche plus le statut de validation, juste le meilleur score et l'objectif
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (levelScore >= level.goal) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusClass = 'goal-met'; // Couleur verte si l'objectif est atteint
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tableHTML += `<tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${level.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="level-score ${statusClass}">${levelScore}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${level.goal} Ã©toiles</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  tableHTML += '</tbody>';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (showTotal) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â tableHTML += `<tfoot><tr><th>TOTAL</th><th colspan="2">${totalScore}</th></tr></tfoot>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  tableHTML += '</table>';
Â  Â  Â  Â  Â  Â  Â  Â  scoreTableContainer.innerHTML = tableHTML;
Â  Â  Â  Â  Â  Â  Â  Â  scoreTableContainer.classList.add('active');
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  // --- Logique du Niveau SpÃ©cial (Niveau 4) ---
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  function changeBorderColor() {
Â  Â  Â  Â  Â  Â  Â  Â  const randomIndex = Math.floor(Math.random() * SPECIAL_LEVEL_COLORS.length);
Â  Â  Â  Â  Â  Â  Â  Â  currentBorderColor = SPECIAL_LEVEL_COLORS[randomIndex];
Â  Â  Â  Â  Â  Â  Â  Â  scoreBoard.style.borderColor = currentBorderColor;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function startSpecialLevelLoop() {
Â  Â  Â  Â  Â  Â  Â  Â  if (currentLevel !== 4 || !gameActive) return;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Initialise la couleur de la bordure
Â  Â  Â  Â  Â  Â  Â  Â  changeBorderColor();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Change la couleur toutes les 3 secondes
Â  Â  Â  Â  Â  Â  Â  Â  colorChangeInterval = setInterval(changeBorderColor, 3000);
Â  Â  Â  Â  Â  Â  Â  Â  specialLevelTip.style.display = 'block';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function stopSpecialLevelLoop() {
Â  Â  Â  Â  Â  Â  Â  Â  if (colorChangeInterval) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(colorChangeInterval);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // RÃ©initialise la bordure du score en blanc
Â  Â  Â  Â  Â  Â  Â  Â  scoreBoard.style.borderColor = '#FFFFFF';Â 
Â  Â  Â  Â  Â  Â  Â  Â  specialLevelTip.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Fonction utilitaire pour convertir RGB en Hex pour la comparaison
Â  Â  Â  Â  Â  Â  function rgbToHex(rgb) {
Â  Â  Â  Â  Â  Â  Â  Â  if (rgb.startsWith('#')) return rgb.toUpperCase();
Â  Â  Â  Â  Â  Â  Â  Â  // Ex : rgb(244, 67, 54)
Â  Â  Â  Â  Â  Â  Â  Â  const parts = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
Â  Â  Â  Â  Â  Â  Â  Â  if (!parts) return '#000000';Â 
Â  Â  Â  Â  Â  Â  Â  Â  function hex(x) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const h = parseInt(x).toString(16).toUpperCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return h.length === 1 ? '0' + h : h;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return '#' + hex(parts[1]) + hex(parts[2]) + hex(parts[3]);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function isStarClickValid(starElement) {
Â  Â  Â  Â  Â  Â  Â  Â  if (currentLevel !== 4) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 1. RÃ©cupÃ©rer la couleur de l'Ã©toile cliquÃ©e (en Hex)
Â  Â  Â  Â  Â  Â  Â  Â  const starColorRGB = window.getComputedStyle(starElement).backgroundColor;
Â  Â  Â  Â  Â  Â  Â  Â  const starColorHex = rgbToHex(starColorRGB);

Â  Â  Â  Â  Â  Â  Â  Â  // 2. RÃ©cupÃ©rer la couleur de la bordure du score (en Hex)
Â  Â  Â  Â  Â  Â  Â  Â  const borderRGB = window.getComputedStyle(scoreBoard).borderColor;
Â  Â  Â  Â  Â  Â  Â  Â  const borderHex = rgbToHex(borderRGB);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // 3. Comparer
Â  Â  Â  Â  Â  Â  Â  Â  return starColorHex === borderHex;
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  // --- Logique de Jeu GÃ©nÃ©rale ---

Â  Â  Â  Â  Â  Â  function updateScore(validClick) {
Â  Â  Â  Â  Â  Â  Â  Â  if (validClick) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scoreElement.textContent = score;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  synth.triggerAttackRelease("C4", "8n");
Â  Â  Â  Â  Â  Â  Â  Â  } else if (currentLevel === 4) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // PÃ©nalitÃ© pour le niveau spÃ©cial si mauvaise couleur cliquÃ©e
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score = Math.max(0, score - 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scoreElement.textContent = score;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  synth.triggerAttackRelease("C3", "16n"); // Son diffÃ©rent pour l'erreur
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function endGame() {
Â  Â  Â  Â  Â  Â  Â  Â  if (!gameActive) return;

Â  Â  Â  Â  Â  Â  Â  Â  gameActive = false;
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(timerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(starSpawnInterval);
Â  Â  Â  Â  Â  Â  Â  Â  stopSpecialLevelLoop(); // ArrÃªter la boucle du niveau spÃ©cial
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  saveLevelScore();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.star').forEach(star => star.remove());

Â  Â  Â  Â  Â  Â  Â  Â  scoreBoard.style.opacity = 0;
Â  Â  Â  Â  Â  Â  Â  Â  gameContainer.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  controlPanel.classList.remove('hidden');Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Afficher le tableau des scores uniquement Ã  la fin
Â  Â  Â  Â  Â  Â  Â  Â  displayLevelScores(true);

Â  Â  Â  Â  Â  Â  Â  Â  const currentLevelConfig = LEVELS.find(l => l.id === currentLevel);
Â  Â  Â  Â  Â  Â  Â  Â  const goalMet = score >= currentLevelConfig.goal;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Afficher TOUJOURS les boutons de sÃ©lection
Â  Â  Â  Â  Â  Â  Â  Â  levelSelectionButtons.style.display = 'flex'; 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (goalMet) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageElement.innerHTML = `âœ… BRAVO ! Niveau **${currentLevelConfig.name}** validÃ© avec un score de ${score} (Objectif : ${currentLevelConfig.goal}). **Choisissez un autre niveau !**`;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messageElement.innerHTML = `âŒ Dommage ! Votre score est de ${score} (Objectif : ${currentLevelConfig.goal}). **Essayez Ã  nouveau ou choisissez un autre niveau.**`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  function updateTimer() {
Â  Â  Â  Â  Â  Â  Â  Â  const levelConfig = LEVELS.find(l => l.id === currentLevel);
Â  Â  Â  Â  Â  Â  Â  Â  if (!levelConfig || !gameActive) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (levelConfig && timeLeft <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countdownDisplay.textContent = "FIN";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (!gameActive) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const initialTime = LEVELS.find(l => l.id === currentLevel)?.time || LEVELS[0].time;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  countdownDisplay.textContent = initialTime + "s";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  countdownDisplay.textContent = timeLeft + "s";

Â  Â  Â  Â  Â  Â  Â  Â  if (timeLeft <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  endGame();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  timeLeft--;
Â  Â  Â  Â  Â  Â  Â  Â  timerInterval = setTimeout(updateTimer, 1000);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function createStar() {
Â  Â  Â  Â  Â  Â  Â  Â  if (!gameActive) return;

Â  Â  Â  Â  Â  Â  Â  Â  const containerWidth = gameScreen.clientWidth;
Â  Â  Â  Â  Â  Â  Â  Â  const containerHeight = gameScreen.clientHeight;

Â  Â  Â  Â  Â  Â  Â  Â  const star = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  star.classList.add('star', `level-${currentLevel}`);

Â  Â  Â  Â  Â  Â  Â  Â  if (currentLevel === 4) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Choisir une couleur alÃ©atoire pour le niveau spÃ©cial et l'appliquer via style
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const randomColorIndex = Math.floor(Math.random() * SPECIAL_LEVEL_COLORS.length);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  star.style.backgroundColor = SPECIAL_LEVEL_COLORS[randomColorIndex];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  star.classList.remove(`level-${currentLevel}`);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  Â  Â  const maxX = containerWidth - STAR_SIZE;
Â  Â  Â  Â  Â  Â  Â  Â  const maxY = containerHeight - STAR_SIZE;
Â  Â  Â  Â  Â  Â  Â  Â  const startX = Math.random() * maxX;
Â  Â  Â  Â  Â  Â  Â  Â  const startY = Math.random() * maxY;
Â  Â  Â  Â  Â  Â  Â  Â  const travelX = Math.random() * maxX;
Â  Â  Â  Â  Â  Â  Â  Â  const travelY = Math.random() * maxY;

Â  Â  Â  Â  Â  Â  Â  Â  star.style.left = `${startX}px`;
Â  Â  Â  Â  Â  Â  Â  Â  star.style.top = `${startY}px`;

Â  Â  Â  Â  Â  Â  Â  Â  gameContainer.appendChild(star);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const animationDuration = STAR_LIFETIME_MS * (1 + (LEVELS.length - currentLevel) * 0.2) * 1.5;

Â  Â  Â  Â  Â  Â  Â  Â  const starAnimation = anime({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targets: star,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  translateX: travelX - startX,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  translateY: travelY - startY,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rotate: '2turn',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: [0.5, 1],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  easing: 'linear',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  duration: animationDuration,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  complete: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (star.parentNode) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  star.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  star.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!gameActive) return;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isValid = isStarClickValid(star);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  star.style.pointerEvents = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  starAnimation.pause();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  anime({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targets: star,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scale: [1, 1.5],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  opacity: [1, 0],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  duration: 300,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  easing: 'easeOutExpo',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  complete: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (star.parentNode) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  star.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateScore(isValid);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function gameLoop() {
Â  Â  Â  Â  Â  Â  Â  Â  if (!gameActive) return;
Â  Â  Â  Â  Â  Â  Â  Â  createStar();
Â  Â  Â  Â  Â  Â  Â  Â  starSpawnInterval = setTimeout(gameLoop, STAR_SPAWN_INTERVAL_MS[currentLevel - 1]);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function startLevel(levelId) {
Â  Â  Â  Â  Â  Â  Â  Â  if (gameActive) return;

Â  Â  Â  Â  Â  Â  Â  Â  Tone.start().then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Audio context started.");
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const levelConfig = LEVELS.find(l => l.id === levelId);
Â  Â  Â  Â  Â  Â  Â  Â  if (!levelConfig) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  currentLevel = levelId;
Â  Â  Â  Â  Â  Â  Â  Â  gameActive = true;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  score = 0;
Â  Â  Â  Â  Â  Â  Â  Â  timeLeft = levelConfig.time;
Â  Â  Â  Â  Â  Â  Â  Â  scoreElement.textContent = score;
Â  Â  Â  Â  Â  Â  Â  Â  currentLevelDisplay.textContent = currentLevel;

Â  Â  Â  Â  Â  Â  Â  Â  // Cacher les messages et tables pour dÃ©marrer le jeu
Â  Â  Â  Â  Â  Â  Â  Â  controlPanel.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  gameContainer.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  scoreBoard.style.opacity = 1;
Â  Â  Â  Â  Â  Â  Â  Â  scoreTableContainer.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  scoreTableContainer.innerHTML = '';


Â  Â  Â  Â  Â  Â  Â  Â  if (levelConfig.isSpecial) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startSpecialLevelLoop();
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  gameLoop();
Â  Â  Â  Â  Â  Â  Â  Â  updateTimer();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function resetGame() {
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(timerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(starSpawnInterval);
Â  Â  Â  Â  Â  Â  Â  Â  stopSpecialLevelLoop(); // ArrÃªter la boucle de couleur si elle Ã©tait active

Â  Â  Â  Â  Â  Â  Â  Â  gameActive = false;
Â  Â  Â  Â  Â  Â  Â  Â  currentLevel = 1;Â 
Â  Â  Â  Â  Â  Â  Â  Â  score = 0;

Â  Â  Â  Â  Â  Â  Â  Â  scoreElement.textContent = 0;
Â  Â  Â  Â  Â  Â  Â  Â  currentLevelDisplay.textContent = 1;
Â  Â  Â  Â  Â  Â  Â  Â  messageElement.textContent = "SÃ©lectionnez un niveau pour commencer.";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Afficher le menu de sÃ©lection
Â  Â  Â  Â  Â  Â  Â  Â  levelSelectionButtons.style.display = 'flex';Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  controlPanel.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  gameContainer.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  scoreBoard.style.opacity = 0;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.star').forEach(star => star.remove());
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Afficher les scores s'il y en a
Â  Â  Â  Â  Â  Â  Â  Â  const currentScores = loadAllScores();
Â  Â  Â  Â  Â  Â  Â  Â  const hasScores = Object.values(currentScores).some(s => s > 0);
Â  Â  Â  Â  Â  Â  Â  Â  if (hasScores) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayLevelScores(true);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scoreTableContainer.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scoreTableContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  levelSelectionButtons.querySelectorAll('.level-button').forEach(button => {
Â  Â  Â  Â  Â  Â  Â  Â  button.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const levelId = parseInt(e.target.dataset.level);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startLevel(levelId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  levelSelectionButtons.style.display = 'none'; // Cacher les boutons pendant le jeu
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // restartButton.addEventListener('click', resetAllScoresAndGame); // RetirÃ©
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Initialisation
Â  Â  Â  Â  Â  Â  resetGame();
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
